# 显示器系统

## 1. 显示器工作原理

当屏幕显示画面时，**CRT**的电子枪从上到下逐行扫描，扫描完成后显示器就呈现一帧画面。然后电子枪回到初始位置进行下一次扫描。

为了同步显示器的显示过程和系统的视频控制器，显示器会用硬件时钟产生一系列的定时信号。当电子枪换行进行扫描时，显示器会发出一个**水平同步信号（horizonal synchronization）**，简称 **HSync**；而当一帧画面绘制完成后，电子枪回复到原位，准备画下一帧前，显示器会发出一个**垂直同步信号（vertical synchronization），简称 VSync**。显示器通常以固定频率进行刷新，这个刷新率就是 VSync 信号产生的频率。虽然现在的显示器基本都是液晶显示屏了，但其原理基本一致。

![](https://pic.existorlive.cn/%E6%88%AA%E5%B1%8F2020-12-16%20%E4%B8%8A%E5%8D%881.17.15.png)

## 2. 显示器系统的组成

在计算机系统中， **CPU**、**GPU**、**显示器**以下图的方式协同工作。**CPU** 计算好显示内容提交到 **GPU**，**GPU** 渲染完成后将渲染结果放入**帧缓冲区**；**视频控制器**会则按固定的频率读取帧缓冲区的数据，经过数模转换传递给**显示器**显示。

![](https://pic.existorlive.cn/%E5%B1%8F%E5%B9%95%E6%98%BE%E5%83%8F%E5%8E%9F%E7%90%86.png)

## 3. 掉帧/卡顿问题

**显示器**以固定的频率(60Hz或者更高)刷新，而**CPU**和**GPU**计算和渲染的速度取决于当前这一帧画面计算的复杂度。当**GPU**不能及时地将渲染后的数据放入**帧缓冲区**，**显示器**就会重复显示同一帧的画面。这种情况称为**掉帧**或**卡顿**。

![](https://pic.existorlive.cn/%E6%88%AA%E5%B1%8F2020-12-16%20%E4%B8%8A%E5%8D%882.00.19.png)

为了处理**掉帧**问题，通常会使用**双帧缓冲区**甚至**三帧缓冲区**。**GPU**会预先渲染好一帧放入一个**帧缓冲区**内，让**视频控制器**读取，当下一帧渲染好后，**GPU**会把**视频控制器**的指针指向第二个**帧缓冲器**，如此一来效率会有很大的提升。

但是**掉帧**的根本原因还是**CPU/GPU渲染流水线过长**，不会因为增加缓冲区而根本解决。

## 4. 画面撕裂问题

在**双缓冲区**的结构下，当显示器从**帧缓冲区A**读取数据扫描一帧画面，而**GPU**渲染好新的一帧数据放入**帧缓冲区B**中。如果**视频控制器**直接将指针指向**帧缓冲区B**，则会造成**画面撕裂**问题（上半截画面属于旧的一帧，下半截画面属于新的一帧）。

![](https://pic.existorlive.cn/ios_vsync_off.jpg)


**GPU**的**垂直同步机制**能够很好的解决**画面撕裂**问题。当**GPU**开启**垂直同步**后，要等到**显示器**发出**V-Sync信号**才会进行下一帧的渲染和缓冲区更新。

但是引入**垂直同步机制**后，**GPU**要等到收到垂直同步信号，才会渲染下一帧。一定程度上拖慢了GPU渲染的速度。


## 参考文档

[图形图像渲染原理](http://chuquan.me/2018/08/26/graphics-rending-principle-gpu/)






