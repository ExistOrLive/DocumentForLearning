# C++ 内存对齐

## 内存对齐规则

1. 数据对齐规则： 结构(struct)(或者联合(union))的数据成员，第一个数据成员放在offset为0的地方，以后每个数据成员存储的起始位置要从该成员大小或者成员的子成员大小(只要该成员有子成员，比如说是数组，结构体等)的整数倍开始。

2. 结构体作为成员：如果一个结构体里有某些结构体成员，则结构体成员要从其内部`最宽基本类型成员`的整数倍地址开始存储。

3. 收尾工作：结构体的总大小，也就是sizeof的结果，必须是其内部最大成员的`最宽基本类型成员`的整数倍，不足要补全

4. sizeof(union)，以结构里面size最大元素为union的size,因为在某一时刻，union只有一个成员真正存储于该地址。



## 内存对齐的原因及作用

1. 平台原因(移植原因)：不是所有的硬件平台都能访问任意地址上的任意数据的；某些硬件平台只能在某些地址处取某些特定类型的数据，否则抛出硬件异常。


2. 性能原因：经过内存对齐后，CPU的访问速度大大提升。


CPU在访问内存时，并不是一个字节一个字节读取，而是把内存当成一块一块的，块的大小可以是2，4，8，16字节大小，因此CPU在读取内存时是一块一块进行读取的。块大小称为`memory access granularity(内存读取粒度)` 。


[C++ 中内存对齐原理及作用][1]

[1]: https://blog.csdn.net/u012611878/article/details/78995574
