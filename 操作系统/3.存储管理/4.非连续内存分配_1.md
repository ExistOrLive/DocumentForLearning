# 非连续内存分配

## 1. 连续内存分配和非连续内存分配比较

**连续内存分配**

- 分配给程序的物理地址空间是连续的
- 会产生内存碎片
- 内存的利用率低


**为了提高内存利用率和管理灵活度，非连续内存分配**

- 分配给程序的物理地址空间不是连续的，逻辑地址空间仍然连续
- 更好的内存利用和管理
- 允许进行共享代码和数据 (同一个物理内存区域映射到不同程序的逻辑内存空间)
- 支持动态加载和动态链接

非连续内存分配需要解决如何建立逻辑地址和物理地址的转换
  

## 2. 分段

进程的地址空间由多个段组成，以更细的粒度管理，灵活的分离和共享：

- 主代码段
- 公共库代码段
- 堆栈段
- 数据段
- 符号表

![](https://gitee.com/existorlive/exist-or-live-pic/raw/master/%E6%88%AA%E5%B1%8F2020-10-16%20%E4%B8%8B%E5%8D%882.13.27.png)


在逻辑地址空间中，段是连续的；而对应在物理地址空间中，段是非连续的。

![](https://gitee.com/existorlive/exist-or-live-pic/raw/master/%E6%88%AA%E5%B1%8F2020-10-16%20%E4%B8%8B%E5%8D%882.15.26.png)

### 2.1 段的概念

- 段表示访问方式和存储数据等属性相同的一段地址空间

- 对应一个连续的内存块

- 若干个段组成进程的逻辑地址空间


### 2.2 段访问机制

逻辑地址由二元组$(s,addr)$表示：

- s 段号
- addr 段内偏移

![](https://gitee.com/existorlive/exist-or-live-pic/raw/master/%E6%88%AA%E5%B1%8F2020-10-16%20%E4%B8%8B%E5%8D%882.37.52.png)


操作系统维护一个**段表**，每一个段号对应段表中的一条记录，每条记录保存**段的基址**和**段的长度**。 

通过逻辑地址访问内存：

- 通过逻辑地址中的段号s在段表找到对应的记录
- 比较偏移量和段的长度，确定地址是否合法
- 偏移量+基址获得物理地址

$
物理地址 = 段基址 + 偏移量
$

![](https://gitee.com/existorlive/exist-or-live-pic/raw/master/%E6%88%AA%E5%B1%8F2020-10-16%20%E4%B8%8B%E5%8D%882.44.08.png)

## 3. 分页

### 3.1 概念

- **帧**（物理地址空间分配单位）
    
      物理地址空间划分为大小相同的基本分配单位。
      单位大小为$2^n$,如512，4096

- **页**（逻辑地址空间分配单位）

       逻辑地址空间划分为大小相同的基本单位。
       页的大小和帧一致。

### 3.2 帧 地址结构

物理地址空间被划分为大小相等的帧。

物理地址由一个二元组表示：$(f,o)$

 - f 帧号 
 - o 帧内偏移（S位，每帧由$2^s$字节）
  
![](https://gitee.com/existorlive/exist-or-live-pic/raw/master/%E6%88%AA%E5%B1%8F2020-10-16%20%E4%B8%8B%E5%8D%883.07.08.png)

$
物理地址 = f * 2^s + o
$

**Example**

![](https://gitee.com/existorlive/exist-or-live-pic/raw/master/%E6%88%AA%E5%B1%8F2020-10-16%20%E4%B8%8B%E5%8D%883.09.00.png)

### 3.3 页 地址结构

逻辑地址空间被划分为大小相等的页，页的大小与帧一致。

逻辑地址由一个二元组表示：$(p,o)$

 - p 页号 与 帧号对应
 - o 页内偏移，等于帧内偏移（S位，每帧由$2^s$字节）

![](https://gitee.com/existorlive/exist-or-live-pic/raw/master/%E6%88%AA%E5%B1%8F2020-10-16%20%E4%B8%8B%E5%8D%883.13.13.png)

$
逻辑地址 = f * 2^s + o
$

### 3.3 页访问机制

操作系统维护一个**页表**，保存了页号和帧号的对应关系。

- 逻辑地址中的页号是连续的
- 连续的页号对应的帧号不是连续的
- 不是所有的页都有对应的帧，页号的范围可以大于帧号范围
  

![](https://gitee.com/existorlive/exist-or-live-pic/raw/master/%E6%88%AA%E5%B1%8F2020-10-16%20%E4%B8%8B%E5%8D%883.41.10.png)










 











  



