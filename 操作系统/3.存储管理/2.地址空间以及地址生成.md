# 地址空间和地址生成

## 1. 地址空间

- **物理地址空间** ： 硬件支持的地址空间

      物理地址空间的大小就是硬件内存条的大小

- **逻辑地址空间** ： 程序在运行过程中拥有的内存范围


> 操作系统需要去维护逻辑地址空间与物理地址空间的映射关系

## 2. 逻辑地址空间的生成

![](https://github.com/existorlive/existorlivepic/raw/master/%E6%88%AA%E5%B1%8F2020-10-14%20%E4%B8%8B%E5%8D%883.13.34.png)

- 程序在汇编，编译，链接的过程中，生成可执行文件，同时会生成起始地址为0的逻辑地址空间。

- 可执行文件保存在硬盘中。当可执行文件加载到内存中时，通过**程序重定位**重新定位逻辑地址空间(起始地址不从0开始).

- 操作系统在内存中维护程序的逻辑地址空间和物理地址空间之间的映射关系。程序在执行过程中需要将逻辑地址转换为物理地址空间。

## 3. 访问逻辑地址空间

CPU访问某个逻辑地址空间中的数据的过程：

1. 由CPU向内存总线发出访问请求：
    
    - ALU：已知逻辑地址空间，并请求访问其中的数据
    - MMU：进行逻辑地址空间和物理地址空间的转换
    - CPU控制单元： 给总线发送物理地址请求

2. 内存：
   
   - 内存将物理地址空间中的数据发送给CPU


> 操作系统需要事先建立逻辑地址空间和物理地址空间之间的映射关系并维护

![](https://github.com/existorlive/existorlivepic/raw/master/%E6%88%AA%E5%B1%8F2020-10-14%20%E4%B8%8B%E5%8D%883.43.14.png)
   
## 4. 地址安全检查

每个程序拥有独立的地址空间，如果一个程序试图访问其他程序的地址空间就是非法的。
因此需要必要的机制保证程序无法访问非法的内存。

操作系统为每个程序维护**起始地址**和**最大地址空间长度**，保存在CPU的**基址寄存器**和**界限寄存器**，以确定地址空间的界限。 

如果程序访问的逻辑地址超出了地址空间的界限，则会向程序报**内存异常错误**。

![](https://github.com/existorlive/existorlivepic/raw/master/%E6%88%AA%E5%B1%8F2020-10-14%20%E4%B8%8B%E5%8D%883.59.32.png)





