## 1.线程的背景

有如下的播放音乐的程序：

**方案1**:

```c
void main(){
    while(true){
        read();          // 从磁盘读文件
        decompress();    // 解码
        play();          // 播放
    }
}
```

但是由于从磁盘中读取问文件与在内存中解压播放往往时间不能同步，不能做到流畅播放；

**方案2:**

改进为多进程协作


```c
// 进程1
void main(){
    while(true){
        read();          // 从磁盘读文件，放入内存缓冲
    }
}

// 进程2
void main(){
    while(true){
        decompress();    // 解码，放入缓冲
    }
}

// 进程3
void main(){
    while(true){
        play();          // 从缓冲区读取播放
    }
}
```

该方案为多进程协作，需要共享的缓冲区；

- 进程间地址空间相互独立，如何通信，共享数据
- 进程维护开销大，每个进程都要维护独立的地址空间；进程切换，保存当前的进程的状态需要开销

**方案3:**

提出一种新的实体：

- 实体间可以并发执行
- 实体间可以共享相同的地址空间。

即 **线程**

## 2. 线程的概念

**线程是进程当中的一条执行流程，共享父进程的资源**

- 从资源组合角度：进程把一组相关的资源组合起来，包括地址空间 (代码段，数据段)，打开的文件等各种资源。
- 从运行的角度： 线程是资源平台的执行流程。

![](https://github.com/existorlive/existorlivepic/raw/master/%E6%88%AA%E5%B1%8F2020-09-28%20%E4%B8%8A%E5%8D%887.08.57.png)

### 2.1 线程 = 进程 - 共享资源

线程的优点：

1. 一个进程可以同时存在多个线程
2. 线程之间可以并发的执行
3. 线程之间共享地址空间和文件资源，线程间通信方便，开销小

线程的缺点：

1. 一个线程崩溃会导致其所属进程的所有线程崩溃，安全可靠性无法保障

适合多进程的场景：
    
     浏览器中多个网页适合多进程的场景，各个网页之间相互不影响，一个网页崩溃，其他网页不会被波及

### 2.2 线程需要维护的信息

线程是CPU调度的单位，所以线程要维护自己的TCB包括：

- 程序计数器
- 寄存器信息
- 堆栈指针
- 线程状态（运行，就绪，阻塞）
  
等等
  
![](https://github.com/existorlive/existorlivepic/raw/master/%E6%88%AA%E5%B1%8F2020-09-28%20%E4%B8%8A%E5%8D%887.19.26.png)


### 2.3 线程和进程的比较

- 进程是资源分配的单位；线程是CPU调度的单位

- 进程具有一个完整的资源平台；而线程只独享必不可少的资源，如寄存器和栈

- 线程同样具有就绪，阻塞和执行三种基本状态，同样具有状态之间的转换关系

- 线程能减少并发执行的时间和空间开销
  
  - 线程的创建，销毁时间比进程短
  - 线程切换时间比进程短(同一进程的线程在内存中的同一页表)
  - 同一进程的线程间共享内存空间和资源，可直接通信不通过内核。

